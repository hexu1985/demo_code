"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();!function(){function e(e){for(var t=document.cookie.split("; "),o=0;o<t.length;o++){var i=t[o].split("=");if(i[0]==e)return decodeURIComponent(i[1])}}function t(e){window.csdn&&window.csdn.report&&window.csdn.report.reportClick(e)}function o(e){window.csdn&&window.csdn.report&&window.csdn.report.reportView(e)}function i(){return/(phone|pad|pod|iphone|ipod|ios|ipad|android|mobile|blackberry|iemobile|mqqbrowser|juc|fennec|wosbrowser|browserng|webos|symbian|windows phone|csdn|MicroMessenger)/i.test(navigator.userAgent)}function s(){var e=window.navigator.userAgent,t="others",o={Sogou:/SE\s2\.X|SogouMobileBrowser/,HuaWei:/HuaweiBrowser/,Quark:/Quark/,Explorer2345:/2345Explorer|2345chrome|Mb2345Browser/,Liebao:/LBBROWSER/,QQBrowser:/QQBrowser/,Baidu:/BIDUBrowser|baidubrowser|BaiduHD/,Toutiao:/NewsArticle|NewsLite/,UC:/UBrowser|UCBrowser|UCWEB/,MiuiBrowser:/MiuiBrowser/,Wechat:/MicroMessenger/,MobileQQ:/Mobile\/\w{5,}\sQQ\/(\d+[\.\d]+)/,Shoujibaidu:/baiduboxapp/,Firefox:/Firefox/,Maxthon:/Maxthon/,Se360:/360SE/,Ee360:/360EE/,TheWorld:/TheWorld/,Weibo:/__weibo__/,NokiaBrowser:/NokiaBrowser/,Opera:/Opera|OPR\/(\d+[\.\d]+)/,Edge:/Edge/,IE:/Trident|MSIE/,Chrome:/Chrome|CriOS/,Safari:/Version[|\/]([\w.]+)(\s\w.+)?\s?Safari|like\sGecko\)\sMobile\/\w{3,}$/,AndroidBrowser:/Android.*Mobile\sSafari|Android\/(\d[\.\d]+)\sRelease\/(\d[\.\d]+)\sBrowser\/AppleWebKit(\d[\.\d]+)/i};for(var i in o)if(o[i].exec(e)){t=i;break}return t}function n(){var e=/micromessenger/.test(navigator.userAgent.toLowerCase()),t=/wxwork/.test(navigator.userAgent.toLowerCase());if("undefined"!=typeof WeixinJSBridge||e)return!t}function r(e){this.app=l(),this.isMobile=i(),this.inputData=e,this.defaultParams={domain:"csdn.net",isIframe:!0,frameWidth:this.isMobile?343:410,frameHeight:this.isMobile?368:520,append:"#passportbox",iframeName:"passport_iframe",from:encodeURIComponent(window.location.href),pvSource:"",service:"",loginService:this.isMobile?"https://passport.csdn.net/waplogin":"https://passport.csdn.net/account/login"};var t=a&&a.spm?a.spm:"",o=e&&e.spm?e.spm:"",s=o||t;s&&(this.inputData=this.inputData||{},this.inputData.spm=h(s)),this.options=Object.assign({},this.defaultParams,this.inputData),this.extend="",this.version="",this.renderCss(),this.fileExtends(),this.init(this.options)}var a={};window.csdn=window.csdn||{};var d=function(e,t,o){var i=new Date;if(o)"number"==typeof o?i.setTime(i.getTime()+o):i=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,0,0,0);else{i.setTime(i.getTime()+2592e6)}document.cookie=e+"="+encodeURIComponent(t)+";expires="+i.toGMTString()+";domain=.csdn.net;path=/"},p=function(e){var t=/([^?#*&=]+)=([^?#*&=]+)/g,o={};return location.href.replace(t,function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var s=t[1],n=t[2];o[s]=n}),o[e]},l=function(){return navigator.userAgent.toLowerCase().indexOf("csdn")>-1},c=function(){if(l()){var e=navigator.userAgent.toLowerCase(),t=JSON.stringify({url:"csdnapp://app.csdn.net/login/quick"});/iphone|ipad|ipod|ios/i.test(e)?window.webkit.messageHandlers.csdnjumpnewpage.postMessage(t):window.jsCallBackListener.csdnjumpnewpage(t)}},h=function(e){var t=e.split(".").length;if(2===t||3===t){var o=document.querySelector('meta[name="report"]'),i=o&&o.getAttribute("content")||"{}",s=JSON.parse(i);return s.spm?s.spm+"."+e:e}return e};r.prototype.init=function(e){return this.app?(window.csdn.loginBox.self=void 0,c(),!1):this.isMobile?(this.wapDistribute(e),!1):void this.getVersion(e)},r.prototype.fileExtends=function(){for(var e in this.inputData)this.defaultParams.hasOwnProperty(e)||(this.extend=this.extend+"&"+e+"="+this.inputData[e])},r.prototype.renderCss=function(){var e=window.document.head,t=e.firstElementChild||e.firstChild,o=document.createElement("style");o.innerText=".passport-login-container{position: fixed;top: 0;left: 0;z-index: 9999;width: 100%;height: 100%;}.passport-login-box{position: absolute;display: block;border-radius: 8px;left: 50%;top: 50%;z-index: 10001;-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);-o-transform: translate(-50%, -50%);-moz-transform: translate(-50%, -50%);transform: translate(-50%, -50%);background-color: #fff;}.passport-login-mark{position: absolute;top: 0;left: 0;z-index: 9999;background-color: rgba(0, 0, 0, 0.5);width: 100%;height: 100%;}",e.insertBefore(o,t)},r.prototype.renderHtml=function(e){var t=this,i=this.options.loginService;this.$loginDom=$('<div class="passport-login-container"><div id='+this.options.append.replace(/[#\.]/,"")+' class="passport-login-box" style="display: block;'+(this.options.frameHeight?"height:"+this.options.frameHeight+"px":"")+'"></div></div>'),this.$markDom=$('<div class="passport-login-mark"></div>'),window.document.domain=this.options.domain,i=i+(-1===i.indexOf("?")?"?from=":"&from=")+this.options.from,i=this.options.service?i+"&service="+this.options.service:i,i+="&iframe=true",i+="&newframe=true",i=this.options.pvSource?i+"&"+this.options.pvSource:i,i=this.version?i+"&version="+this.version:i,i=this.extend?i+this.extend:i,this.$iframeHtml=$('<iframe  width="'+this.options.frameWidth+'" height="'+this.options.frameHeight+'" name="'+this.options.iframeName+'" src="'+i+'" style="border-radius: 8px;" frameborder="0" scrolling="no"></iframe>'),this.$closeBtn=$('<span style="display: inline-block; color: #999; font-size: 22px; cursor: pointer; position:absolute; top:2%; right:3%;-moz-user-select:none; -webkit-user-select:none; user-select:none;">&times</span>'),this.$closeBtn.on("click",function(){t.close()}),this.$markDom.on("click",function(){t.close()}),this.$loginDom.append(this.$markDom),$("body").append(this.$loginDom),$(this.options.append).append(this.$iframeHtml),$(this.options.append).append(this.$closeBtn);var s={};return"auto"!==e.showType?s={spm:"3001.6428"}:"10s"===e.way?s={spm:"3001.7902"}:"3t"===e.way&&(s={spm:"3001.7961"}),o(s),!0},r.prototype.close=function(){t({spm:"3001.6428"}),this.$loginDom.remove(),window.csdn.loginBox.self=void 0},r.prototype.getVersion=function(e){var t=this;$.ajax({type:"get",url:"https://passport.csdn.net/v1/register/pc/iframe/login/version",crossDomain:!0,xhrFields:{withCredentials:!0},contentType:"application/json",success:function(o){o.status?(t.options.frameWidth=o.data.width,t.options.frameHeight=o.data.height,t.version=o.data.controlVersion,t.renderHtml(e)):t.renderHtml(e)},error:function(o){t.renderHtml(e)}})},r.prototype.wapDistribute=function(e){var t=this,o={platform:"WAP",source:t.options.pvSource,spm:t.options.spm};$.ajax({type:"get",url:"https://passport.csdn.net/v1/login/distribute/login/route?from="+t.options.from,data:o,crossDomain:!0,xhrFields:{withCredentials:!0},contentType:"application/json",success:function(o){if(o.status){if(!o.data.popup)return window.csdn.loginBox.self=void 0,window.location.href=o.data.routeUrl,!1;t.options.frameWidth=o.data.width,t.options.frameHeight=o.data.height,t.renderHtml(e)}else t.renderHtml(e)},error:function(o){t.renderHtml(e)}})};var u=function(){function t(e){_classCallCheck(this,t),this.callBackFn=null,this.app=l(),this.inputData=e,this.defaultParams={status:"activate",domain:"csdn.net",isIframe:!0,frameWidth:295,frameHeight:370,append:"#passportbox2",iframeName:"passport_iframe2",from:encodeURIComponent(window.location.href),loginService:"https://passport.csdn.net/key"},e.spm&&(this.inputData.spm=h(e.spm)),this.options=Object.assign({},this.defaultParams,this.inputData),this.extend="",this.renderCss(),this.fileExtends(),this.init(this.options)}return _createClass(t,[{key:"getUserStatus",value:function(t){var o=this;this.callBackFn=t,$.ajax({url:"https://passport.csdn.net/v1/api/check/userstatus",type:"POST",contentType:"application/json",xhrFields:{withCredentials:!0},data:JSON.stringify({username:e("UserName")||""}),dataType:"json",success:function(e){if(e.status)if(e.detail){switch(e.detail){case"deleted":o.options.status="deleted",o.options.frameHeight=178;break;case"activate":o.options.status="activate";break;default:return!0}o.renderHtml()}else o.executeCallBack();else o.close(),window.csdn.loginBox.show()},error:function(e){void 0}})}},{key:"renderCss",value:function(){var e=window.document.head,t=e.firstElementChild||e.firstChild,o=document.createElement("style");o.innerText=".passport-login-container2{position: fixed;top: 0;left: 0;z-index: 9999;width: 100%;height: 100%;}.passport-login-box2{position: absolute;display: block;border-radius: 8px;left: 50%;top: 50%;z-index: 10001;-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);-o-transform: translate(-50%, -50%);-moz-transform: translate(-50%, -50%);transform: translate(-50%, -50%);background-color: #fff;}.passport-login-mark2{position: absolute;top: 0;left: 0;z-index: 9999;background-color: rgba(0, 0, 0, 0.5);width: 100%;height: 100%;}",e.insertBefore(o,t)}},{key:"renderHtml",value:function(e){var t=this,i=this.options.loginService;if(this.$loginDom=$('<div class="passport-login-container2"><div id='+this.options.append.replace(/[#\.]/,"")+' class="passport-login-box2" style="display: block;'+(this.options.frameHeight?"height:"+this.options.frameHeight+"px":"")+'"></div></div>'),this.$markDom=$('<div class="passport-login-mark2"></div>'),window.document.domain=this.options.domain,i=i+(-1===i.indexOf("?")?"?status=":"&status=")+this.options.status,i=this.extend?i+this.extend:i,this.$iframeHtml=$('<iframe  width="'+this.options.frameWidth+'" height="'+this.options.frameHeight+'" name="'+this.options.iframeName+'" src="'+i+'" style="border-radius: 8px;" frameborder="0" scrolling="no"></iframe>'),this.$closeBtn=$('<span style="display: inline-block; color: #999; font-size: 22px; cursor: pointer; position:absolute; top:2%; right:3%;-moz-user-select:none; -webkit-user-select:none; user-select:none;">&times</span>'),this.$closeBtn.on("click",function(){t.close()}),this.$markDom.on("click",function(){t.close()}),this.$loginDom.append(this.$markDom),$("body").append(this.$loginDom),$(this.options.append).append(this.$iframeHtml),$(this.options.append).append(this.$closeBtn),this.options.spm){o({spm:this.options.spm})}}},{key:"close",value:function(){this.$loginDom&&this.$loginDom.remove(),window.csdn.loginBox.self2=void 0}},{key:"fileExtends",value:function(){for(var e in this.inputData)this.defaultParams.hasOwnProperty(e)||(this.extend=this.extend+"&"+e+"="+this.inputData[e])}},{key:"init",value:function(e){this.getUserStatus()}},{key:"executeCallBack",value:function(){this.callBackFn&&this.callBackFn(),this.close()}}]),t}();window.csdn.loginBox={self:void 0,self2:void 0,show:function(t){return e("UserName")?void void 0:l()?void new r(t):void(this.self||(this.self=new r(t)))},key:function(t){e("UserName")&&!l()&&(this.self2||(this.self2=new u(t)))},close:function(){return this.self.close()},loginout:function(e){var t=Object.assign({},e);$.ajax({type:"post",url:"https://passport.csdn.net/account/logout",data:JSON.stringify(t),crossDomain:!0,xhrFields:{withCredentials:!0},success:function(e){},error:function(e){}})},setlogin:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{UserName:void 0,UserToken:void 0},t=e.UserName||p("UserName"),o=e.UserToken||p("UserToken"),i=Object.assign({},{username:t,userToken:o});return new Promise(function(e,t){$.ajax({type:"post",url:"https://passport.csdn.net/v1/login/wap/userToken/refresh",data:JSON.stringify(i),crossDomain:!0,contentType:"application/json",xhrFields:{withCredentials:!0},success:function(t){e(t)},error:function(e){t(e)}})})}},$(document).on("click",".c-login-check",function(t){a=$(this).data("reportClick")||$(this).parent().data("reportClick")||$(this).parent().parent().data("reportClick")||{},e("UserName")||(t.stopPropagation(),window.csdn.loginBox.show())}),$(document).ready(function(){var t=s(),o=e("popTimes"),r=e("popShowed"),a="Baidu"===t||"Shoujibaidu"===t,p=n(),c=window.location.pathname,h=c.indexOf("/article/details")>=0;if(!(r||!h||!i()||l()||e("UserName")||a||p)){var u=setTimeout(function(){if(r)return clearTimeout(u),void(u=null);window.csdn.loginBox.show({showType:"auto",way:"10s",spm:"3001.7902"}),r||d("popShowed","yes","toToday24h"),clearTimeout(u),u=null},1e4);if(!o)return void d("popTimes","one","toToday24h");if("one"===o)return void d("popTimes","two","toToday24h");window.csdn.loginBox.show({showType:"auto",way:"3t",spm:"3001.7961"}),r||d("popShowed","yes","toToday24h")}}),$(document).ready(function(){var t=n(),o=e("keyTimes"),s=e("keyShowed"),r=window.location.pathname,a=r.indexOf("/article/details")>=0;if(!s&&a&&i()&&!l()&&e("UserName")&&t){var p=setTimeout(function(){if(s)return clearTimeout(p),void(p=null);window.csdn.loginBox.key({spm:"3001.7962"}),s||d("keyShowed","yes","toToday24h"),clearTimeout(p),p=null},1e4);if(!o)return void d("keyTimes","one","toToday24h");if("one"===o)return void d("keyTimes","two","toToday24h");window.csdn.loginBox.key({spm:"3001.7963"}),s||d("keyShowed","yes","toToday24h")}}),window.addEventListener("message",function(e){if("https://passport.csdn.net"!==e.origin)return!1;switch(e.data){case"key-close":window.csdn.loginBox.self2&&window.csdn.loginBox.self2.close();break;case"im_client":window.csdn.loginBox.self2&&window.csdn.loginBox.self2.close(),window.open("https://csdn.s2.udesk.cn/im_client/?web_plugin_id=29181");break;case"pop":window.csdn.loginBox.self2&&window.csdn.loginBox.self2.close(),window.csdn.loginBox.show();break;case"page_reload":window.csdn.loginBox.self2&&window.csdn.loginBox.self2.close(),window.location.reload();break;default:return!1}},!1)}();