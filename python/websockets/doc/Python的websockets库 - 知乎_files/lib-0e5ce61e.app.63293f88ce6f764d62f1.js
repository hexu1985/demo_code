"use strict";(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[887],{52627:function(t,e,n){n.d(e,{As:function(){return Be},BU:function(){return Ve},EN:function(){return ve},Ho:function(){return Fe},RK:function(){return Ne},RP:function(){return De},S_:function(){return pe},TS:function(){return oe},Zd:function(){return Xe},cx:function(){return ee},fN:function(){return Jt},p1:function(){return te},pE:function(){return qe},rI:function(){return Ee}});var o,r=n(5241),a=n.n(r),i=n(67541),c=n.n(i),l=n(20315),s=n.n(l),u=n(23061),d=n.n(u),f=n(67051),g=n.n(f),h=n(63170),m=n.n(h),p=n(46246),v=n.n(p),b=n(99712),A=n.n(b),k=n(6885),y=n.n(k),w=n(87363),C=n(58386),x=n.n(C),B=n(17222),L=(n(77638),n(48457)),z=n(47859),G=n(69975),S=n(23323),Z=n(18034),O=n(64102),R=n(68562),j=n(75926),I=n.n(j),E=n(47112),T=n.n(E),W=n(86193),P=n(37831),D=n(72928),N=n.n(D),K=n(48340),M=n(12856),_=n(26111),V=n.n(_),q=n(70164),U=n(36014),H=n(49595),Q=n(38301),F=n.n(Q),X=n(55270),Y=n(76745),J=n.n(Y),$=n(91840),tt=n(61533),et=n(11116),nt=n(40491),ot=n.n(nt),rt=n(53719),at=n(37015),it=n(14910),ct=n(1319),lt=["as","tag","className","html","clearBoth","richContentKey","root","Portal","useHooks"],st=["text","target","url","image","imageWidth","imageHeight","component","className","size","children"],ut=["inEditor","data-text","href","zaBlock"],dt=["root"],ft=["node","tagName"],gt=["src","useWebP","useMp4","onRef","onLoadStateChange","onPlayChange"],ht=["html","css","options","ConditionalImage","linkCardInfo"],mt=["lazyLoadImageOptions","useGifPortalOption"];function pt(t,e,n){if(e&&!Array.isArray(e)&&"number"==typeof e.length){var o=e.length;return function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}(e,void 0!==n&&n<o?n:o)}return t(e,n)}var vt=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){e.forEach((function(e){"function"==typeof e?e(t):e&&(e.current=t)}))}};function bt(t){var e=this;return t.length?function(n,o){for(var r=t.length-1,a=n;r>=0;)a=t[r].call(e,a,o),r--;return a}:x()}var At="function"==typeof queueMicrotask?queueMicrotask:function(t){return Promise.resolve().then(t)},kt=function(t){var e=(0,w.useRef)(null);(0,w.useEffect)((function(){if(t)return At((function(){t&&(e.current=function(t){var e=new IntersectionObserver((function(t){t.forEach(n)}),{threshold:[.1]});function n(t){if(0!==t.intersectionRatio){var n=t.target;n.dataset.zaDetailViewId=n.cardShowViewId,B.Z.trackCardShow(n,{},{link:{url:n.href}}),e.unobserve(n),n.clickViewId&&(n.dataset.zaDetailViewId=n.clickViewId)}}return[{cardShowViewId:1042,clickViewId:1043,selector:"a.external, a.internal"},{cardShowViewId:1044,clickViewId:1045,selector:"a.member_mention, a.UserLink-link"},{cardShowViewId:174,clickViewId:175,selector:"a.video-box"},{cardShowViewId:171,clickViewId:172,selector:'a[data-draft-type="link-card"]'},{cardShowViewId:7692,selector:"a.FileLinkCard .FileLinkCard-info"},{cardShowViewId:9744,selector:".Catalog"}].forEach((function(n){var o=n.selector,r=n.cardShowViewId,a=n.clickViewId;Array.from(t.querySelectorAll(o)).forEach((function(t){t.cardShowViewId=r,t.clickViewId=a,e.observe(t)}))})),function(){e.disconnect()}}(t))})),function(){e.current&&e.current()}}),[t])},yt=function(t){return{elementLocation:{type:"Button",content:{type:t.dataset.zaContentType}}}},wt=function(t){return{attachedInfoBytes:t.dataset.zaAttachInfo}},Ct=[{selector:"a.external, a.internal",zaBlock:"ZTextLink"},{selector:"a.member_mention, a.UserLink-link",zaBlock:"ZTextMention"},{selector:"a.video-box",zaBlock:"ZTextVideoCard"},{selector:'a.LinkCard.old[data-draft-type="link-card"]',zaBlock:"ZTextLinkCard"},{selector:'a.LinkCard.new.static[data-draft-type="link-card"]:not([data-za-content-type="Zvideo"])',zaBlock:"ZTextLinkCard",viewInfoBuilder:yt,extraInfoBuilder:wt},{selector:'a.LinkCard.new.static[data-draft-type="link-card"][data-za-content-type="Zvideo"]',zaBlock:"ZTextZVideoLinkCard",viewInfoBuilder:yt,extraInfoBuilder:wt},{selector:"a.FileLinkCard",zaBlock:"ZTextFileLinkCard"}],xt=function(t){var e,n,o=t.element,r=t.config,a=null===(e=r.viewInfoBuilder)||void 0===e?void 0:e.call(r,o,r),i=Object.assign({elementLocation:{type:"Button"},block:r.zaBlock},a),c=Object.assign({action:"OpenUrl",elementLocation:{type:"Button"},block:r.zaBlock,eventType:"Click"},a),l=Object.assign({link:{url:o.href}},null===(n=r.extraInfoBuilder)||void 0===n?void 0:n.call(r,o,r)),s=(0,L.Q4)().trackEvent,u=(0,L.x3)(i,l),d=(0,z.Z)((function(t){s(c,l),"ZTextLinkCard"===r.zaBlock&&o.dataset.isEcommerce&&t.preventDefault()}));return(0,w.useEffect)((function(){return o.addEventListener("click",d),function(){o.removeEventListener("click",d)}}),[]),(0,w.useEffect)((function(){return u(o),function(){return u(null)}}),[]),null},Bt=function(t){var e=t.root,n=(0,w.useState)([]),o=pt(y(),n,2),r=o[0],a=o[1];return(0,w.useEffect)((function(){if(e){var t=[];Ct.forEach((function(n){var o=n.selector;Array.from(e.querySelectorAll(o)).forEach((function(e){t.push({el:e,config:n})}))})),a(t)}}),[e]),(0,R.tZ)(w.Fragment,{children:r.map((function(t,e){var n=t.el,o=t.config;return(0,R.tZ)(xt,{element:n,config:o},e)}))})},Lt=/<p><br><\/p>/g,zt=/<[^<>\s]+(\s|>)/,Gt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"solid";return{borderBottom:"1px ".concat(e," ").concat(t.colors.GBK05A)}},St=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"solid";return{borderBottom:"1px ".concat(e," ").concat(t.colors.GBL07A)}},Zt=function(t){return{color:t.colors.GBL07A,"&:hover":St(t)}},Ot=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[data-focus-visible]";return A()({outline:"none",transition:"box-shadow 0.3s"},"html".concat(e," &"),{boxShadow:"0 0 0 2px ".concat(t.colors.GBK99A,", 0 0 0 4px ").concat(t.colorMod(t.colors.GBL01A).alpha(.3))})},Rt=(0,W.F4)(o||(o=v()(["\n   from { opacity: 0; }\n   to { opacity: 1; }\n"]))),jt=function(t){var e="1.4em";return Object.assign({wordBreak:"break-word",lineHeight:"1.6","> [data-first-child]":{marginTop:0},"> :last-child":{marginBottom:0},"h1,h2":{clear:"left",marginTop:"calc((".concat(e," * 2) / 1.2)"),marginBottom:"calc(".concat(e," / 1.2)"),fontSize:"1.2em",lineHeight:1.5,fontWeight:t.fontWeights.bold},"h3,h4,h5,h6":{clear:"left",marginTop:"calc((".concat(e," * 1.5) / 1.1)"),marginBottom:"calc(".concat(e," / 1.1)"),fontSize:"1.1em",lineHeight:"1.5",fontWeight:t.fontWeights.bold},u:{textDecoration:"none",borderBottom:"1px solid ".concat(t.colors.GBK03A)},b:{fontWeight:t.fontWeights.bold},sup:{fontSize:"0.8em"},"sup[data-draft-type='reference']":{color:t.colors.GBL07A},"a:focus":Ot(t),"a.ztext-link,a.internal,a.external":Object.assign(Object.assign({textDecoration:"none",cursor:"pointer"},Gt(t)),{},{"&:hover":Object.assign({color:t.colors.GBL07A},St(t))," > .ellipsis::after":{content:"'...'"},"> .invisible":{font:"0/0 a",color:"transparent",textShadow:"none",backgroundColor:"transparent"},u:{border:"none"}}),"a.member_mention":Zt(t),"a.UserLink-link":Zt(t),p:{margin:"".concat(e," 0")},"p.ztext-empty-paragraph":{margin:"calc((".concat("2.8em","- (").concat(e," * 2 + 1.6em)) / 2) 0"),"+ .ztext-empty-paragraph":{margin:"".concat(e," 0")}},hr:{margin:"4em auto",width:"240px",maxWidth:"100%",border:"none",borderTop:"1px solid ".concat(t.colors.GBK08A)},"img[eeimg]":Object.assign({maxWidth:"100%",verticalAlign:"middle"},t.isDarkMod&&{filter:"invert(1)"}),'img[eeimg="1"]':{margin:"0 3px",maxWidth:"calc(100% - 6px)",display:"inline-block"},'img[eeimg="2"]':{margin:"".concat(e," auto"),display:"block"},blockquote:{margin:"".concat(e," 0"),paddingLeft:"1em",color:t.colors.GBK04A,borderLeft:"3px solid ".concat(t.colors.GBK08A)},"ol,ul":{margin:"".concat(e," 0"),padding:0,width:"100%","ol,ul":{margin:0},"li::before":{width:"1em"},"> ol, > ul":{display:"table-row","&::before":{display:"table-cell",content:"''"}}},ul:{display:"table","&>li":{display:"table-row",listStyle:"none","&::before":{display:"table-cell",content:"'•  '",whiteSpace:"pre"}}},ol:{display:"table",counterReset:"ol","> li":{display:"table-row",listStyle:"none","&::before":{display:"table-cell",textAlign:"right",counterIncrement:"ol",content:"counter(ol) '. '",whiteSpace:"pre"}}},"ol ol":{counterReset:"ol2","li::before":{counterIncrement:"ol2",content:"counter(ol2) '. '"}},"ol ol ol":{counterReset:"ol3","li::before":{counterIncrement:"ol3",content:"counter(ol3) '. '"}},"ol ol ol ol":{counterReset:"ol4","li::before":{counterIncrement:"ol4",content:"counter(ol4) '. '"}},figure:{margin:"".concat(e," 0"),".content_image,.origin_image":{margin:"0 auto"},figcaption:{marginTop:"calc(0.6em / 0.9)",padding:"0 1em",fontSize:"0.9em",lineHeight:"1.5",textAlign:"center",color:t.colors.GBK06A},"& + figure":{marginTop:"calc(".concat(e," * 1.6)")},"&[data-size='small'],&:not([data-size]) > [data-size='small']":{clear:"both"},"&[data-size='left'],&:not([data-size]) > [data-size='left']":{float:"left",margin:"0 20px 20px 0",maxWidth:"33%"},"&[data-size='right'],&:not([data-size]) > [data-size='right']":{float:"right",margin:"0 0 20px 20px",maxWidth:"33%"},"&[data-size='collapse']":{marginBottom:0,"& + figure":{marginTop:0}}},".content_image, .origin_image":{display:"block",maxWidth:"100%",height:"auto",margin:"".concat(e," auto"),"&[data-size='small']":{maxWidth:"40%"},"&.zh-lightbox-thumb":{cursor:"zoom-in"}},code:{margin:"0 2px",padding:"3px 4px",borderRadius:"3px",fontFamily:t.fonts.monospace,fontSize:"0.9em",backgroundColor:t.colors.GBK10A},pre:{margin:"".concat(e," 0"),padding:"calc(0.8em / 0.9)",fontSize:"0.9em",wordBreak:"initial",wordWrap:"initial",whiteSpace:"pre",overflow:"auto",WebkitOverflowScrolling:"touch",background:t.colors.GBK10A,borderRadius:"4px",code:{margin:0,padding:0,fontSize:"inherit",borderRadius:0,backgroundColor:"inherit"}},"li pre":{whiteSpace:"pre-wrap"},"table[data-draft-type='table']":{borderCollapse:"collapse",fontSize:"15px",margin:"".concat(e," auto"),maxWidth:"100%",tableLayout:"fixed",textAlign:"left",width:"100%","&[data-size='small']":{minWidth:"260px",width:"40%"},"&[data-row-style='striped'] tr:nth-of-type(2n + 1)":{background:t.colors.GBK10A},"td,th":{border:"1px solid ".concat(t.colors.GBK08A),lineHeight:"24px",height:"24px",padding:"3px 12px"},th:{background:t.colors.GBK09A,color:t.colors.GBK02A,fontWeight:500}},"& .video-box, & .link-box":{position:"relative",display:"flex",justifyContent:"space-between",margin:"".concat(e," 0"),overflow:"auto",whiteSpace:"normal",cursor:"pointer",border:"solid 1px ".concat(t.colors.GBK09A),borderRadius:"4px"}},function(t){return{".lazy[data-lazy-status]":{backgroundColor:t.colors.GBK10A},'.lazy[data-lazy-status="ok"]':{backgroundColor:"transparent",animation:"".concat(Rt," 0.5s ease-in")}}}(t))},It=[function(t){return t?t.replace(Lt,'<p class="ztext-empty-paragraph"><br /></p>'):t},function(t){return t?t.replace(zt,(function(t,e){return t.replace(e," data-first-child".concat(e))})):t}],Et=(0,w.forwardRef)((function(t,e){var n,o=t.as,r=t.tag,a=t.className,i=t.html,c=t.clearBoth,l=void 0!==c&&c,s=t.richContentKey,u=t.root,d=t.Portal,f=t.useHooks,g=m()(t,lt),h=bt(It);f(u);var p=null!==(n=null!=o?o:r)&&void 0!==n?n:"div";return(0,R.BX)(R.HY,{children:[d&&(0,R.tZ)(d,{root:u}),(0,R.tZ)(p,Object.assign({ref:e,css:function(t){return Object.assign(Object.assign(Object.assign({},jt(t)),function(t){return{"& .highlight":{margin:"1em 0",pre:{margin:0},".hll":{backgroundColor:t.colors.GBK12A},".c":{fontStyle:"italic",color:t.colors.GBK06A},".err":{color:t.colors.GRD03A},".k":{fontWeight:t.fontWeights.bold},".o":{fontWeight:t.fontWeights.bold},".cm":{fontStyle:"italic",color:t.colors.GBK06A},".cp":{fontWeight:t.fontWeights.bold,color:t.colors.GBK06A},".c1":{fontStyle:"italic",color:t.colors.GBK06A},".cs":{fontStyle:"italic",fontWeight:t.fontWeights.bold,color:t.colors.GBK06A},".gd":{color:t.colors.GRD01A},".ge":{fontStyle:"italic"},".gr":{color:t.colors.GRD03A},".gh":{color:t.colors.GBK06A},".gi":{color:"#12b370"},".go":{color:t.colors.GBK05A},".gp":{color:t.colors.GBK04A},".gs":{fontWeight:t.fontWeights.bold},".gu":{color:t.colors.GBK06A},".gt":{color:t.colors.GRD03A},".kc":{fontWeight:t.fontWeights.bold},".kd":{fontWeight:t.fontWeights.bold},".kn":{fontWeight:t.fontWeights.bold},".kp":{fontWeight:t.fontWeights.bold},".kr":{fontWeight:t.fontWeights.bold},".kt":{fontWeight:t.fontWeights.bold,color:t.colors.GBL07A},".m":{color:t.colors.GBL01A},".s":{color:t.colors.GRD03A},".na":{color:t.colors.GBL01A},".nb":{color:t.colors.GBL01A},".nc":{fontWeight:t.fontWeights.bold,color:t.colors.GBL07A},".no":{color:t.colors.GBL01A},".ni":{color:t.colors.GRD07A},".ne":{fontWeight:t.fontWeights.bold,color:t.colors.GRD03A},".nf":{fontWeight:t.fontWeights.bold,color:t.colors.GRD03A},".nn":{color:t.colors.GBK04A},".nt":{color:t.colors.GBL07A},".nv":{color:t.colors.GBL01A},".ow":{fontWeight:t.fontWeights.bold},".w":{color:t.colors.GBK07A},".mf":{color:t.colors.GBL01A},".mh":{color:t.colors.GBL01A},".mi":{color:t.colors.GBL01A},".mo":{color:t.colors.GBL01A},".sb":{color:t.colors.GRD03A},".sc":{color:t.colors.GRD03A},".sd":{color:t.colors.GRD03A},".s2":{color:t.colors.GRD03A},".se":{color:t.colors.GRD03A},".sh":{color:t.colors.GRD03A},".si":{color:t.colors.GRD03A},".sx":{color:t.colors.GRD03A},".sr":{color:t.colors.GYL02A},".s1":{color:t.colors.GRD03A},".ss":{color:t.colors.GRD03A},".bp":{color:t.colors.GBK06A},".vc":{color:t.colors.GBL01A},".vg":{color:t.colors.GBL01A},".vi":{color:t.colors.GBL01A},".il":{color:t.colors.GBL01A},"&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-thumb:horizontal":{backgroundColor:t.colorMod(t.colors.GBK02A).alpha(.5),borderRadius:"6px","&:hover":{backgroundColor:t.colorMod(t.colors.GBK02A).alpha(.6)}}}}}(t)),l&&{"&::before, &::after":{clear:"both",content:'""',display:"block"}})},className:T()("RichText","ztext",a,{"RichText--clearBoth":l}),dangerouslySetInnerHTML:{__html:h(i)}},g),s||i)]})}));Et.propTypes={as:I().string,tag:I().string,html:I().string.isRequired,clearBoth:I().bool,ref:I().func,Portal:I().func,useHooks:I().func},Et.defaultProps={useHooks:x()};var Tt=(0,w.memo)(Et),Wt=(0,w.forwardRef)((function(t,e){var n=N()(t,["entityType","entityData","notCommerce"]),o=n.text,r=n.target,a=n.url,i=n.image,c=n.imageWidth,l=n.imageHeight,s=n.component,u=n.className,d=n.size,f=n.children,g=m()(n,st),h=function(t,e){if(t>0&&e>0){var n=t/e;if(n>1.2)return"180x120";if(n<=.8)return"120x160"}return"ipico"}(c,l),p=(0,K.imgUrl)(i,h);return(0,R.tZ)(s,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({ref:e,target:r,href:a,"data-draft-node":"block","data-draft-type":"link-card"},p&&{"data-image":p}),c&&{"data-image-width":c}),l&&{"data-image-height":l}),d&&{"data-size":d}),o!==a&&o&&{"data-text":o}),{},{className:T()("LinkCard new",u)},g),{},{children:f||(0,R.BX)(R.HY,{children:[(0,R.BX)("span",{className:"LinkCard-contents",children:[(0,R.tZ)("span",{className:"LinkCard-title loading","data-text":!0}),(0,R.tZ)("span",{className:"LinkCard-desc loading"})]}),(0,R.tZ)("span",{className:"LinkCard-image LinkCard-image--default"})]})}))}));Wt.propTypes={component:I().oneOfType([I().string,I().func]),target:I().string,url:I().string.isRequired,text:I().string,image:I().string,imageWidth:I().oneOfType([I().string,I().number]),imageHeight:I().oneOfType([I().string,I().number])},Wt.defaultProps={component:"a",target:"_blank"};var Pt={answer:"回答",article:"文章",zvideo:"视频",question:"问题",collection:"收藏夹",roundtable:"圆桌",topic:"话题"},Dt={voteupCount:"赞同",commentCount:"评论",playCount:"播放",followerCount:"关注",answerCount:"回答",visitCount:"浏览",discussionCount:"讨论"},Nt={answer:["voteupCount","commentCount"],article:["voteupCount","commentCount"],zvideo:["playCount","voteupCount"],question:["followerCount","answerCount"],collection:["visitCount","followerCount"],topic:["visitCount","discussionCount"],default:["followerCount","visitCount"]},Kt=function(t){var e=t.twoLine,n=t.children;return Boolean(n)&&(0,R.tZ)("span",{className:T()("LinkCard-title",{"two-line":e}),children:n})},Mt=function(t){var e=t.data,n=e.objectType,o=(Nt[n]||Nt.default).map((function(t){var n=e[t];return"".concat((0,q.Zh)(n)).concat(Dt[t])})).filter(Boolean).join(" · ");return(0,R.BX)("span",{className:"LinkCard-desc",children:[o,(0,R.tZ)("span",{className:"LinkCard-tag",children:Pt[n]})]})},_t=function(t){var e=t.url,n=(0,w.useMemo)((function(){var t=null,n=V()(e,!0);return"link.zhihu.com"===n.hostname&&(t=n.query.target),(t||e).replace(/^https?:\/\//,"")}),[e]);return(0,R.BX)("span",{className:"LinkCard-desc",children:[(0,R.tZ)(U.n,{size:14,center:!0}),n]})},Vt=function(t){var e=t.url,n=t.isVideo,o=t.ratio,r=void 0===o?1:o,a=t.onClick;return Boolean(e)&&(0,R.BX)("span",{className:"LinkCard-image",style:{height:60*r},children:[(0,R.tZ)("img",{src:e,onClick:a,alt:n?"点击可播放视频":""}),n&&(0,R.tZ)("span",{className:"LinkCard-image--video",children:(0,R.tZ)(H.D,{size:10,center:!0})})]})},qt=function(t,e){var n=t.url,o=t.data,r=t.onClick,a=t.onClickImage,i=o.title,c=o.thumbnail,l=o.objectType;return(0,R.BX)(R.HY,{children:[(0,R.BX)("span",{ref:e,className:"LinkCard-contents",onClick:r,children:[(0,R.tZ)(Kt,{twoLine:!0,children:i}),l?(0,R.tZ)(Mt,{data:o}):(0,R.tZ)(_t,{url:n})]}),(0,R.tZ)(Vt,{url:c,isVideo:"zvideo"===l,onClick:a})]})},Ut=(0,w.forwardRef)(qt),Ht=function(t){var e=t.className,n=t.html;return n?(0,R.tZ)("span",{className:"LinkCard-richText ".concat(e),dangerouslySetInnerHTML:{__html:"<object>".concat(n,"</object>")}}):null},Qt=function(t){var e=t.data,n=e.title,o=e.desc,r=e.url,a=e.image,i=e.ratio,c=e.isVideo;return(0,R.BX)(R.HY,{children:[(0,R.BX)("span",{className:"LinkCard-contents",children:[(0,R.tZ)(Kt,{twoLine:!0,children:n},"title"),(0,R.tZ)(Ht,{className:"LinkCard-desc",html:o}),!o&&(0,R.tZ)(_t,{url:r},"url")]}),(0,R.tZ)(Vt,{url:a,ratio:i,isVideo:c})]})},Ft={ANSWER:"Answer",ARTICLE:"Column",ZVIDEO:"Zvideo",QUESTION:"Question",COLLECTION:"Collection",ROUNDTABLE:"Roundtable",SPECIAL:"Special",TOPIC:"Topic"},Xt=function(t){var e=(0,w.useMemo)((function(){return function(t){var e={};if(t.data){var n=(0,M.camelizeKeys)(JSON.parse(t.data)),o=n.source,r=void 0===o?{}:o,a=n.display,i=void 0===a?{}:a,c=n.zaData,l=void 0===c?{}:c,s=i.cardOpenUrl,u=i.title,d=i.content,f=i.desc,g=i.image||{};e={source:r,url:s,title:u,content:d,desc:f,image:g.imageUrl,ratio:g.ratio,isVideo:g.isVideo,zaAttachInfo:l.attachInfo}}return Object.assign(Object.assign(Object.assign({},e),t),{},{title:t.text||e.title,image:e.image||t.image})}(t)}),[t]),n=e.source,o=e.target,r=e.title,a=e.url,i=e.zaAttachInfo;return(0,R.tZ)(Wt,{notCommerce:!0,target:o,text:r,url:a,"data-za-attach-info":i,"data-za-content-type":Ft[null==n?void 0:n.contentType]||"Unknown",className:"static",children:(0,R.tZ)(Qt,{data:e})})},Yt=/([-\w]+)(="([^"]+)"|='([^']+)')?/g,Jt=function(t){for(var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.decodeValue,r=void 0!==o&&o,a={};e=Yt.exec(t);){var i=e[1],c=e[3]||e[4];a[i]=(r?te(c):c)||""}return a},$t=function(t){if(!t)return null;try{return JSON.parse(t)}catch(t){return null}};function te(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.replace(/&amp;/g,"&").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#34;/g,'"').replace(/&#13;/g,"\r")}function ee(){return Math.max(window.innerHeight/10,100)}var ne=function(t){for(var e=t;e&&"HTML"!==e.tagName&&"BODY"!==e.tagName&&1===e.nodeType;){var n=document.defaultView.getComputedStyle(e);if([n.overflow,n.overflowY,n.overflowX].some((function(t){return"scroll"===t||"auto"===t})))return e;e=e.parentNode||e.parentElement}return window};function oe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=ne(t),r=t.getBoundingClientRect().top+(o.pageYOffset||o.scrollTop||0)-(n?ee():0)-e;o.scrollTo({top:r,behavior:"smooth"})}var re=/<a\b([^>]*data-draft-type="link-card"[^>]*)>(.*?)<\/a>/g,ae=function(t){var e=t.target,n=t.url,o=t.component,r=t.className;return(0,R.tZ)(o,{target:e,href:n,"data-draft-node":"block","data-draft-type":"link-card","data-is-ecommerce":"1",className:T()("LinkCard",r),children:(0,R.BX)("span",{className:"LinkCard-content LinkCard-ecommerceLoadingCard",children:[(0,R.tZ)("div",{className:"LinkCard-ecommerceLoadingCardAvatarWrapper",children:(0,R.tZ)("img",{src:"https://pic2.zhimg.com/v2-1b0bbef27f0496a58468f92d94c8a80e_l.png",className:"LinkCard-ecommerceLoadingCardNetwork"})}),(0,R.BX)("div",{className:"LinkCard-ecommerceLoadingCardLoadingbar",children:[(0,R.tZ)("span",{}),(0,R.tZ)("span",{})]})]})})};ae.defaultProps={component:"a",target:"_blank"};var ie=/<a\b([^>]*BIZ(=|%3D)ECOMMERCE[^>]*)>(.*?)<\/a>/g;var ce=function(){function t(e){var n,o,r,a=this;d()(this,t),r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.url||(a.url=t),t!==a.url)throw new Error("mismatch url\n".concat(t,"\n").concat(a.url),t,a.url);return new Promise((function(t,n){a.addToQueue({options:e,resolve:t,reject:n})}))},(o="fetch")in(n=this)?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,this.instance=null,this.customFetch=e,this.delay=200,this.maxDelay=1e3,this.url="",this.queueMaxLength=10,this.queue=[],this.startTime=Date.now(),this.timeout=null,this.initialized=!1}var e;return g()(t,[{key:"initConfig",value:function(t){var e=t.delay,n=t.maxDelay,o=t.maxBatchCount;e&&(this.delay=e),n&&(this.maxDelay=n),o&&(this.maxBatchCount=o),this.initialized=!0}},{key:"buildFetchParams",value:function(t){var e=pt(y(),t,1)[0].options,n=t.reduce((function(t,e){var n,o;return(null===(n=(o=e.options).dataBuilder)||void 0===n?void 0:n.call(o,t,e))||t}),{}),o=this.url,r=!e.method||"GET"===e.method.toUpperCase();if(r){var a=V()(o,!0);a.query=Object.assign(Object.assign({},a.query),n),o=a.toString()}return[o,Object.assign(Object.assign({},e),{},{data:r?null:Object.assign(Object.assign({},e.data),n)})]}},{key:"doFetch",value:(e=s()(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.queue.length){t.next=2;break}return t.abrupt("return");case 2:return e=this.queue,this.queue=[],t.prev=4,t.next=7,this.customFetch.apply(this,pt(c(),this.buildFetchParams(e)));case 7:n=t.sent,e.forEach((function(t){var e=t.options,o=t.resolve;e.resultBuilder?o(e.resultBuilder(n)):o(n)})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),e.forEach((function(e){return e.reject(t.t0)}));case 14:case"end":return t.stop()}}),t,this,[[4,11]])}))),function(){return e.apply(this,arguments)})},{key:"addToQueue",value:function(t){var e=this;this.initialized||this.initConfig(t.options),clearTimeout(this.timeout),(Date.now()-this.startTime>this.maxDelay||this.queue.length>=this.maxBatchCount)&&(this.startTime=Date.now(),this.doFetch()),this.queue.push(t),setTimeout((function(){e.startTime=Date.now(),e.doFetch()}),this.delay)}}]),t}(),le=null,se=function(){throw new Error("Not implemented")},ue=function(){return function(t){return function(e,n){return le||(le=new ce(t)),le.fetch(e,n)}}(function(t){return function(){var e=s()(a().mark((function e(n,o){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(n,o);case 2:return r=e.sent,e.t0=M.camelizeKeys,e.next=6,r.json();case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}("undefined"!=typeof fetch?fetch:se))},de="https://www.zhihu.com/api/v4/link_card_infos",fe=J()((function(){if(!(0,X.isBrowser)())return de;var t=window.location,e=t.hostname,n=t.origin;return[".zpres.zhihu.dev",".zpres.zhihu.com"].some((function(t){return e.endsWith(t)}))?"".concat(n,"/api/v4/link_card_infos"):de})),ge={},he=function(t,e,n){var o=t["data-text"],r=t.href,a=t.zvideoLinkCardProps;(0,w.useEffect)((function(){n&&(0,$.y3)(e.current,(function(){return t=e.current,void B.Z.trackCardShow(t,{id:7844},{button:{text:"inlinezvideo"}});var t}))}),[n,e]);var i=(0,z.Z)((function(t){!function(t,e,n){var o;B.Z.trackEvent(t.target,{id:7846,action:"OpenUrl"},{button:{text:"inlinezvideo"}}),null==e||null===(o=e.onImageClick)||void 0===o||o.call(e,t,n)}(t,{title:o,url:r,video:{}})})),c=(0,z.Z)((function(t){!function(t,e,n){var o;B.Z.trackEvent(t.target,{id:7846,action:"OpenUrl"},{button:{text:"inlinezvideo"}}),null==e||null===(o=e.onImageClick)||void 0===o||o.call(e,t,n)}(t,a,{title:o,url:r})}));return n?{handleImageClick:i,handleInfoClick:c}:{}},me={answer:"Answer",article:"Column",zvideo:"Zvideo",question:"Question",collection:"Collection",roundtable:"Roundtable",topic:"Topic"},pe=w.forwardRef((function(t,e){var n=N()(t,["zvideoLinkCardProps"]),o=n.inEditor,r=n["data-text"],i=n.href,c=n.zaBlock,l=m()(n,ut),u=(0,w.useRef)(),d=function(t){var e=(0,w.useRef)(0),n=t.inEditor,o=t["data-offset-key"],r=t["data-text"],i=t["data-image"],c=t.href,l=(0,w.useRef)(!1),u=(0,w.useRef)(c),d="draftjs"===n,f=(0,w.useState)((function(){return d&&ge[o]||null})),g=pt(y(),f,2),h=g[0],m=g[1],p=(0,G.Z)({once:!0}),v=pt(y(),p,2),b=v[0],A=v[1],k=(0,z.Z)((function(t){var e=t||h;if(!e||0===Object.keys(e).length)return{objectType:null,title:r||c,thumbnail:i};e.title=r||e.title||c,e.thumbnail=i||e.thumbnail;var n=Object.assign(Object.assign({},e),{},{cached:!0});return d&&(ge[o]=n),n})),C=(0,z.Z)(ue()),x=(0,z.Z)(s()(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.current+=1,t.prev=1,t.next=4,C(fe(),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"},dataBuilder:function(t){return t.urls="".concat(t.urls?t.urls+",":"").concat(c),t},resultBuilder:function(t){return t[c]}});case 4:n=t.sent,m(k(n)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),e.current<=1?x():m(k());case 11:case"end":return t.stop()}}),t,null,[[1,8]])}))));return(0,w.useEffect)((function(){(!A||h&&h.cached)&&u.current===c||x()}),[A,h,x,c]),(0,w.useEffect)((function(){n&&l.current&&m(k(u.current!==c?{title:r}:null))}),[n,k,r,c]),(0,w.useEffect)((function(){u.current=c}),[c]),(0,w.useEffect)((function(){l.current=!0}),[]),[b,h]}(t),f=pt(y(),d,2),g=f[0],h=f[1],p=he(t,u,"zvideo"===(null==h?void 0:h.objectType)),v=p.handleImageClick,b=p.handleInfoClick,A=(0,w.useCallback)(vt(e,g,u),[]),k=o?Ut:L.$U,C=o?null:{as:Ut,shouldTrackShow:!0,zaText:!0,zaType:"Button",zaAction:"OpenUrl",zaBlock:c,extra:{link:{url:i}},"data-za-module":"Content"},x=(0,R.tZ)(k,Object.assign(Object.assign({},C),{},{url:i,data:h,onClick:b,onClickImage:v}));return(0,R.tZ)(Wt,Object.assign(Object.assign({ref:A,text:r,url:i,component:"a"},l),{},{children:Boolean(h)&&(0,R.tZ)(L.eV,{content:{type:me[h.objectType]||"Unknown"},children:x})}))})),ve=function(t){return function(e){var n=(0,w.useState)(null),o=pt(y(),n,2),r=o[0],a=o[1],i=t.idAttr,c=t.selector,l=t.component,s=t.targetClassName,u=t.cardDataFilter,d=t.getCardProps,f=e.root,g=m()(e,dt),h=i&&c&&s&&(0,w.useCallback)((function(t){return function(t){var e=t.idAttr,n=t.targetClassName;return function(t){var o=t.getAttribute(e),r=document.createElement("div");return r.className=n,t.parentNode.replaceChild(r,t),{data:{id:o},target:r}}}({idAttr:i,targetClassName:s})(t)}),[i,s]),p=(0,w.useMemo)((function(){return h?function(t){return Array.from(t.querySelectorAll(c)).map(h)}:x()}),[h,f,c]);return(0,w.useEffect)((function(){if(f||c&&u){var t=(u||p)(f).map((function(t){var e=t.data,n=t.target,o=null;return"function"==typeof d&&(o=d(e)),(0,tt.createPortal)((0,R.tZ)(l,Object.assign(Object.assign({id:e.id},o),g),e.id),n)}));t.length>0&&a(t)}}),[f]),r}},be=ve({cardDataFilter:function(t){return Array.from(t.querySelectorAll("a.LinkCard[data-draft-type=link-card]:not([data-is-ecommerce])")).map((function(t){var e,n=(e=t.attributes,Array.from(e).reduce((function(t,e){return"class"===e.name?t.className=e.value:t[e.name]=e.value,t}),{})),o=document.createElement("div");return o.className="RichText-LinkCardContainer",t.parentNode.replaceChild(o,t),{data:n,target:o}}))},getCardProps:function(t){return t.href&&t.href.match(/https:\/\/www.zhihu.com\/zvideo\/(\d+)$/)?t.zaBlock="ZTextZVideoLinkCard":t.zaBlock="ZTextLinkCard",t},component:pe}),Ae=function(t){return{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,borderRadius:"inherit",height:80,boxSizing:"border-box",background:t.colorMod(t.colors.GBK10A).alpha(.88),color:t.colors.GBK08A}},ke=function(t){return{width:60,height:60,background:t.colors.GBK09A,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,marginRight:10}},ye=function(t){return{height:60,flex:1,display:"flex",flexDirection:"column",span:{height:16,display:"inline-block",background:t.colors.GBK09A},"span:nth-of-type(1)":{width:60,marginBottom:4},"span:nth-of-type(2)":{width:127}}},we=function(t){return{".LinkCard.old":{position:"relative",display:"block",margin:"1em auto",width:390,boxSizing:"border-box",borderRadius:12,maxWidth:"100%",overflow:"hidden","&,&:hover":{textDecoration:"none",border:"none !important",color:"inherit !important"}},".LinkCard-ecommerceLoadingCard":Ae(t),".LinkCard-ecommerceLoadingCardAvatarWrapper":ke(t),".LinkCard-ecommerceLoadingCardNetwork":{width:20,height:20},".LinkCard-ecommerceLoadingCardLoadingbar":ye(t)}},Ce=function(t){return{position:"relative",display:"flex",boxSizing:"border-box",flexDirection:"row",alignItems:"center",width:390,minHeight:84,borderRadius:8,maxWidth:"100%",overflow:"hidden",margin:"16px auto",padding:"12px 12px 9px 12px",backgroundColor:t.colors.GBK10A,"&, &:hover":{textDecoration:"none",border:"none !important",color:"inherit !important"},".LinkCard-contents":{display:"block",flex:"1 1 auto",position:"relative",".loading":{height:14,background:t.colors.GBK09A,borderRadius:7},"&.withTitle":{marginBottom:3}},".LinkCard-title":Object.assign(Object.assign({display:"block",fontSize:15,fontWeight:500,lineHeight:1.4,marginBottom:2,color:t.colors.GBK02A},(0,et.S)(1)),{},{"&.two-line":Object.assign({lineHeight:"20px"},(0,et.S)(2)),"&.loading":{marginBottom:8,width:"80%","&.withTitle":{marginBottom:6}},"&.loadingTitle":{marginBottom:5}}),".LinkCard-excerpt":Object.assign(Object.assign({display:"block",textOverflow:"ellipsis",fontSize:13,lineHeight:"18px",color:t.colors.GBK06A,marginBottom:4},(0,et.S)(1)),{},{".LinkCard-author":{color:t.colors.GBK03A}}),".LinkCard-desc":Object.assign(Object.assign({display:"block",fontSize:13,height:18,lineHeight:"18px",color:t.colors.GBK06A,wordBreak:"break-all"},(0,et.S)(1)),{},{".LinkCard-tag,.tag":{display:"inline-block",fontSize:11,marginLeft:8,padding:"0 4px",borderRadius:3,background:t.colorMod(t.colors.GBK08A).alpha(.3)},"&.loading":{width:"40%"},svg:{marginRight:2}}),".LinkCard-image":{flex:"0 0 auto",backgroundColor:t.colors.GBK09A,backgroundSize:"cover",backgroundPosition:"center",position:"relative",display:"block",width:60,height:60,marginLeft:20,objectFit:"cover",borderRadius:"inherit",overflow:"hidden","&.LinkCard-image--default":{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t.colors.GBK09A,color:t.colors.GBK08A,svg:{color:t.colors.GBK06A}},img:{width:"100%",height:"100%",objectFit:"cover"},".LinkCard-image--video":{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",width:24,height:24,borderRadius:12,background:t.colorMod(t.colors.GBK99C).alpha(.9),pointerEvents:"none",svg:{color:t.colors.GBK03A}}},".LinkCard-richText":{".text":{color:t.colors.GBK03A},".bold":{fontWeight:t.fontWeights.bold},".tag":{marginLeft:4}}}},xe=function(t){return{".LinkCard.new":Ce(t)}},Be=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(t,Object.assign({credentials:"include",headers:{"X-Requested-With":"Fetch"}},e)).then((function(t){return t.json()}))},Le=function(t){return Object.assign(Object.assign({},we(t)),xe(t))},ze=function(t){return Object.assign(Object.assign({},xe(t)),we(t))},Ge=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.rootMargin,r=n.threshold,a=n.once,i=void 0===a||a;t=Array.isArray(t)?t:t?[t]:[];var c=(0,w.useRef)(null),l=(0,z.Z)(e);(0,w.useEffect)((function(){if(t.length)return c.current&&t.forEach((function(t){return c.current.unobserve(t)})),c.current=new IntersectionObserver((function(t){t.forEach((function(t){t.intersectionRatio>0&&(l(t),i&&c.current.unobserve(t.target))}))}),{rootMargin:o,threshold:r}),t.forEach((function(t){return c.current.observe(t)})),function(){t.forEach((function(t){return c.current.unobserve(t)}))}}),[t,o,JSON.stringify(r),i])},Se=n(76745);var Ze="function"==typeof Image,Oe={},Re=Ze?Se((function(t){return new Promise((function(e){return n=t,o=function(t,n){Oe[t]=n,e(n)},(r=new Image).onload=function(){var t=r.width>0&&r.height>0;o(n,t)},r.onerror=function(){o(n,!1)},void(r.src="data:image/webp;base64,"+{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"}[n]);var n,o,r}))})):function(){return Promise.resolve(!1)},je=function(t){var e=Oe[t],n=(0,w.useState)(e),o=pt(y(),n,2),r=o[0],a=o[1];return Ze&&void 0===e&&Re(t).then(a),r},Ie={class:"className"},Ee=(0,w.forwardRef)((function(t,e){var n=t.node,o=t.tagName,r=m()(t,ft),a=(0,w.useMemo)((function(){return function(t){return Array.from(t.attributes).reduce((function(t,e){var n=Ie[e.name]||e.name;return"style"!==n&&(t[n]=e.value),t}),{})}(n)}),[n]);return(0,w.createElement)(o||n.tagName.toLowerCase(),Object.assign(Object.assign(Object.assign({},a),r),{},{ref:e}))})),Te=ot()((function(){return/Mobile/.test(navigator.userAgent)}));function We(t,e){var n={monitor:{type:"Event",imgResourceErrorInfo:{error_description:e,img_url:t,img_from:"web"}}};B.Z.trackMonitor({name:e},n)}var Pe=function(t){var e=t.onLoadStateChange,n=t.onImageLoaded,o=t.enableWebP,r=t.size,a=t.quality;return function(t){var i=t.target,c=function(t){var e=t.image,n=t.enableWebP,o=t.size,r=t.quality,a=void 0===r?80:r,i=e.dataset,c=i.actualsrc,l=i.actualgif;return n&&l&&l.match(/.gif$/i)?c:(o||(o="720w",!Te()&&window.devicePixelRatio>=1.5&&(o="1440w"),Te()&&window.devicePixelRatio*window.innerWidth>=1080&&(o="1440w")),(0,K.imgUrl)(c,{quality:a,size:o}))}({image:i,enableWebP:o,size:r,quality:a});if(o&&(c=function(t){return t.replace(/\.(jpg|png|jpeg|gif)/,".webp")}(c)),i.dataset.rawheight&&!i.getAttribute("height")&&i.setAttribute("height",i.dataset.rawheight),i.src=c,i.complete)return i.dataset.lazyStatus="ok",void(null==n||n());e&&i.addEventListener("loadstart",(function(){e("loadstart",c)})),i.dataset.lazyStatus="loading";var l=setTimeout((function(){i.complete||We(i.url,"image_web_timeout_image"),e&&e("timeout",c)}),15e3);i.addEventListener("load",(function(){i.dataset.lazyStatus="ok",clearTimeout(l),We(i.url,"image_web_success_image"),e&&e("load",c),null==n||n()})),i.addEventListener("error",(function(){clearTimeout(l),We(i.url,"image_web_fail_image"),e&&e("error",c)}))}},De=function(t){var e=t.node,n=t.useWebP,o=void 0===n||n,r=t.onLoadStateChange,a=t.size,i=t.quality,c=t.index,l=e.classList.contains("lazy"),s=je("lossless"),u=(0,G.Z)({once:!0,rootMargin:"600px"}),d=pt(y(),u,3),f=d[0],g=d[1],h=d[2],m=(0,S.Z)(!l),p=pt(y(),m,2),v=p[0],b=p[1],A=(0,z.Z)(b.on),k=(0,z.Z)(Pe({onLoadStateChange:r,onImageLoaded:A,enableWebP:s&&o,size:a,quality:i}));(0,w.useEffect)((function(){g&&k(h)}),[h,g,k]);var C=(0,w.useMemo)((function(){return{elementLocation:{type:"Image",moduleId:"image_card",moduleIndex:c}}}),[c]),x=(0,L.x3)(C),B=(0,Z.Z)(v?x:void 0,l?f:void 0),O=(0,L.Q4)().trackEvent,j=(0,z.Z)((function(){return v&&O(C)}));return(0,R.tZ)(Ee,{node:e,ref:B,onClick:j})},Ne=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.useWebP,o=void 0===n||n,r=e.disabled,a=void 0!==r&&r,i=e.onLoadStateChange,c=e.size,l=e.quality,s=(0,w.useState)([]),u=pt(y(),s,2),d=u[0],f=u[1],g=je("lossless");Ge(d,Pe({onLoadStateChange:i,enableWebP:g&&o,size:c,quality:l}),{rootMargin:"300px"}),(0,w.useEffect)((function(){if(t&&!a){var e=Array.from(t.querySelectorAll("img.lazy:not([data-thumbnail])"));e.length&&f(e)}}),[t,a])},Ke=function(t){var e=t.root,n=t.options;return Ne(e,n),null},Me=function(t,e){B.Z.trackEvent(t,{action:"StatusReport",element:"Card"},{status:{result:e}})},_e=function(t,e){var n,o,r;null===(n=window)||void 0===n||null===(o=n.Raven)||void 0===o||null===(r=o.captureException)||void 0===r||r.call(o,t,{fingerprint:["gif2mp4"],extra:e})},Ve=function(t){var e=t.src,n=t.useWebP,o=void 0===n?"auto":n,r=t.useMp4,a=void 0!==r&&r,i=t.onRef,c=t.onLoadStateChange,l=t.onPlayChange,s=m()(t,gt),u=(0,w.useState)(""),d=pt(y(),u,2),f=d[0],g=d[1],h=(0,w.useState)(null),p=pt(y(),h,2),v=p[0],b=p[1],A=(0,w.useState)(Date.now()),k=pt(y(),A,2),C=k[0],L=k[1],z=(0,w.useState)(!1),G=pt(y(),z,2),S=G[0],Z=G[1],j=(0,w.useState)(null),I=pt(y(),j,2),E=I[0],T=I[1],W=je("animation"),P=(0,w.useCallback)((function(){var t=((0,rt.imgPathParse)(e)||{}).hash;a&&(0,$.y3)(v,(function(){var e;(e=t,fetch("https://api.zhihu.com/gif2mp4/".concat(e),{credentials:"include",headers:{"X-Requested-With":"Fetch"}}).then((function(t){return t.json()}))).then((function(t){var e,n,o=t.playlist,r=(null==o||null===(e=o.SD)||void 0===e?void 0:e.play_url)||(null==o||null===(n=o.LD)||void 0===n?void 0:n.play_url);r&&at.ZP.increment("Gif2Mp4Player.mp4.fetch.success.count"),g(r)})).catch(x())}))}),[v,e,a]);(0,w.useEffect)(P,[e,a,v]),(0,w.useEffect)((function(){v&&B.Z.setModule(v,{module:"GifItem"})}),[v]),Ge(v,(function(){B.Z.trackCardShow(v,{element:"Card"})})),(0,O.Z)((function(){at.ZP.increment("Gif2Mp4Player.mp4.play.failure.count"),_e(new Error("Gif2Mp4 play timeout"),{src:e,videoUrl:f}),Z(!1)}),S?2e3:null),(0,O.Z)((function(){at.ZP.increment("Gif2Mp4Player.mp4.play.success.count"),at.ZP.timing("Gif2Mp4Player.mp4.first_frame_time",Date.now()-C-100),Z(!1),T(null)}),E);var D=(0,rt.default)(e,{extension:("auto"===o?W:o)?"webp":"gif"});return(0,R.tZ)(ct.ZP,Object.assign({videoUrl:f,src:D,onRef:(0,w.useCallback)(vt(i,b),[]),onPlayChange:function(t){null==l||l(t),t||(L(Date.now()),f&&(at.ZP.increment("Gif2Mp4Player.mp4.click.count"),Z(!0)),B.Z.trackEvent(v,{action:"Click",element:"Image"}))},onLoadStart:function(){if(f){var t=it.parse(f).expiration;t&&Number(t)<Date.now()/1e3+900&&P()}L(Date.now()),c&&c("loadstart",D)},onSuccess:function(){Me(v,"Success"),f?S&&T(100):at.ZP.timing("Gif2Mp4Player.gif.first_frame_time",Date.now()-C),c&&c("load",D)},onFailed:function(t){Me(v,"Fail"),f&&(S&&(at.ZP.increment("Gif2Mp4Player.mp4.play.failure.count"),Z(!1),T(null)),_e(t,{videoUrl:f,src:e})),c&&c("error",D)}},s))},qe=function(t){var e=t.node,n=t.Component,o=void 0===n?Ve:n,r=(0,w.useMemo)((function(){return function(t){var e=t.dataset,n=e.thumbnail,o=e.size,r=e.rawheight;return{src:n,poster:n,size:o,width:e.rawwidth,height:r}}(e)}),[e]);return(0,R.tZ)(o,Object.assign({},r))},Ue=function(t){return function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).Component,n=void 0===e?Ve:e,o=(0,w.useState)(null),r=pt(y(),o,2),a=r[0],i=r[1];return(0,w.useEffect)((function(){if(t){var e=Array.from(t.querySelectorAll("img.origin_image[data-thumbnail],img.content_image[data-thumbnail]"));if(e.length){var o=e.map((function(t,e){var o=document.createElement("div");return o.className="RichText-gifPlaceholder",t.parentNode.replaceChild(o,t),(0,tt.createPortal)((0,R.tZ)(qe,{node:t,Component:n},e),o)}));i(o)}}}),[t]),a}(t.root,t.options)},He=function(t){var e=t.root,n=t.ConditionalImage,o=(0,w.useState)([]),r=pt(y(),o,2),a=r[0],i=r[1];return(0,w.useEffect)((function(){if(e){var t=Array.from(e.querySelectorAll("img.origin_image,img.content_image"));if(t.length){var o=t.map((function(t,e){var o=document.createElement("div");return t.parentNode.replaceChild(o,t),(0,tt.createPortal)((0,R.tZ)(n,{index:e,node:t},e),o)}));i(o)}}}),[e]),a},Qe=bt([function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.linkCardInfo;return t?t.replace(re,(function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Jt(e,{decodeValue:!0}),a=r.target,i=void 0===a?"_blank":a,c=r.href,l=void 0===c?"":c,s=r["data-image"],u=r["data-image-width"],d=r["data-image-height"],f=r["data-entity-type"],g=r["data-entity-data"],h=r["data-size"],m=r["data-is-ecommerce"];if(m)return t;var p=o.replace(/<[^>]*>/g,"");p=te(p),l.match(/https:\/\/www.zhihu.com\/zvideo\/(\d+)$/)&&!p&&(p="知乎视频");var v=n?Xt:Wt;return(0,P.renderToStaticMarkup)((0,R.tZ)(v,Object.assign({text:p,url:l,target:i,image:s,imageWidth:u,imageHeight:d,entityType:f,entityData:$t(g),size:h},n&&{data:n[l]})))})):t},function(t){return t?t.replace(ie,(function(t,e){var n=Jt(e,{decodeValue:!0}),o=n["data-draft-type"],r=n.href,a=n.class;return"link-card"!==o?t:(0,P.renderToStaticMarkup)((0,R.tZ)(ae,{url:r,className:F()(a,{old:!0,new:!1,static:!1})}))})):t}]),Fe=(0,w.forwardRef)((function(t,e){var n=(0,w.useState)(null),o=pt(y(),n,2),r=o[0],a=o[1],i=t.html,c=t.css,l=t.options,s=void 0===l?{}:l,u=t.ConditionalImage,d=t.linkCardInfo,f=m()(t,ht),g=s.lazyLoadImageOptions,h=s.useGifPortalOption,p=m()(s,mt);kt(r);var v=[Le,ze,c].reduce((function(t,e){return e||(e={}),"function"==typeof e?function(n){return Object.assign(Object.assign({},t(n)),e(n))}:function(n){return Object.assign(Object.assign({},t(n)),e)}}),(function(t){return{}})),b=(0,w.useCallback)(vt(e,a),[]);return(0,R.BX)(w.Fragment,{children:[!d&&(0,R.tZ)(be,{css:ze,root:r}),u?(0,R.tZ)(He,{root:r,ConditionalImage:u}):(0,R.BX)(R.HY,{children:[(0,R.tZ)(Ke,{root:r,options:g}),(0,R.tZ)(Ue,{root:r,options:h})]}),(0,R.tZ)(Bt,{root:r}),(0,R.tZ)(Tt,Object.assign({ref:b,html:Qe(i,{linkCardInfo:d}),css:v,root:r,options:p},f))]})})),Xe=/<sup\b([^>]*data-draft-type="reference"[^>]*)>(.*?)<\/sup>/g}}]);
//# sourceMappingURL=lib-0e5ce61e.app.63293f88ce6f764d62f1.js.map