<!DOCTYPE html>
<!-- saved from url=(0037)http://c.biancheng.net/view/2362.html -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta name="applicable-device" content="pc,mobile">
<meta name="MobileOptimized" content="width">
<meta name="HandheldFriendly" content="true">
<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="format-detection" content="telephone=no">
<link rel="shortcut icon" href="http://c.biancheng.net/favicon.ico?v=1.6.83">
<link href="./Python traceback模块：获取异常信息_files/common.css" rel="stylesheet">
<title>Python traceback模块：获取异常信息</title>
<meta name="description" content="异常对象提供了一个 with_traceback 用于处理异常的传播轨迹，查看异常的传播轨迹可追踪异常触发的源头，也可看到异常一路触发的轨迹。 下面示例显示了如何显示异常传播轨迹： clas">
</head>
<body>
<div id="topbar" class="clearfix">
<ul id="product-type" class="left">
<li>
<a href="http://c.biancheng.net/"><span class="iconfont iconfont-home"></span>首页</a>
</li>
<li class="active">
<a href="http://c.biancheng.net/sitemap/" rel="nofollow"><span class="iconfont iconfont-book"></span>教程</a>
</li>
<li>
<a href="http://vip.biancheng.net/p/vip/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-vip"></span>VIP会员</a>
</li>
<li>
<a href="http://vip.biancheng.net/p/q2a/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-q2a"></span>一对一答疑</a>
</li>
<li>
<a href="http://fudao.biancheng.net/" rel="nofollow" target="_blank"><span class="iconfont iconfont-fudao"></span>辅导班</a>
</li>
<li>
<a href="http://c.biancheng.net/view/9648.html" rel="nofollow" target="_blank"><span class="iconfont iconfont-weixin"></span>公众号</a>
</li>
</ul>
</div>
<div id="header" class="clearfix">
<a id="logo" class="left" href="http://c.biancheng.net/">
<img height="26" src="./Python traceback模块：获取异常信息_files/logo.png" alt="C语言中文网">
</a>
<ul id="nav-main" class="hover-none left clearfix">
<li class="wap-yes"><a href="http://c.biancheng.net/">首页</a></li>
<li><a href="http://c.biancheng.net/c/">C语言教程</a></li>
<li><a href="http://c.biancheng.net/cplus/">C++教程</a></li>
<li><a href="http://c.biancheng.net/python/">Python教程</a></li>
<li><a href="http://c.biancheng.net/java/">Java教程</a></li>
<li><a href="http://c.biancheng.net/linux_tutorial/">Linux入门</a></li>
<li><a href="http://c.biancheng.net/sitemap/" title="网站地图">更多&gt;&gt;</a></li>
</ul>
<span id="sidebar-toggle" class="toggle-btn" toggle-target="#sidebar">目录 <span class="iconfont"></span></span>
<a href="http://vip.biancheng.net/?from=topbar" class="user-info iconfont iconfont-user hover-none" target="_blank" rel="nofollow" title="用户中心"></a>
</div>
<div id="main" class="clearfix">
<div id="sidebar" class="toggle-target">
<div id="contents">
<dt><span class="iconfont iconfont-list-vertical" aria-hidden="true"></span><a href="http://c.biancheng.net/python/">Python</a></dt>
<dd>
<span class="channel-num">1</span>
<a href="http://c.biancheng.net/python/base/">Python编程基础</a>
</dd>
<dd>
<span class="channel-num">2</span>
<a href="http://c.biancheng.net/python/explore/">Python编程环境搭建</a>
</dd>
<dd>
<span class="channel-num">3</span>
<a href="http://c.biancheng.net/python/variable/">变量类型和运算符</a>
</dd>
<dd>
<span class="channel-num">4</span>
<a href="http://c.biancheng.net/python/list_tuple_dict/">列表、元组、字典和集合</a>
</dd>
<dd>
<span class="channel-num">5</span>
<a href="http://c.biancheng.net/python/str_method/">Python字符串常用方法</a>
</dd>
<dd>
<span class="channel-num">6</span>
<a href="http://c.biancheng.net/python/flow_control/">Python流程控制</a>
</dd>
<dd>
<span class="channel-num">7</span>
<a href="http://c.biancheng.net/python/function/">函数和lambda表达式</a>
</dd>
<dd>
<span class="channel-num">8</span>
<a href="http://c.biancheng.net/python/class_object/">Python类和对象</a>
</dd>
<dd>
<span class="channel-num">9</span>
<a href="http://c.biancheng.net/python/special_member/">类特殊成员（属性和方法）</a>
</dd>
<dd class="this"> <span class="channel-num">10</span> <a href="http://c.biancheng.net/python/try_except/">Python异常处理机制</a> </dd><dl class="dl-sub"><dd>10.1 <a href="http://c.biancheng.net/view/4593.html">什么是异常处理</a></dd><dd>10.2 <a href="http://c.biancheng.net/view/vip_7101.html">为什么一定要学Python异常处理机制？</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.3 <a href="http://c.biancheng.net/view/4599.html">Python try except</a></dd><dd>10.4 <a href="http://c.biancheng.net/view/vip_7103.html">深度剖析Python异常处理机制的底层实现</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.5 <a href="http://c.biancheng.net/view/4600.html">Python try except else</a></dd><dd>10.6 <a href="http://c.biancheng.net/view/2316.html">Python try except finally</a></dd><dd>10.7 <a href="http://c.biancheng.net/view/vip_7107.html">一篇文章，带你重温整个Python异常处理机制</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.8 <a href="http://c.biancheng.net/view/2360.html">Python raise</a></dd><dd>10.9 <a href="http://c.biancheng.net/view/4611.html">Python sys.exc_info()获取异常信息</a></dd><dd class="active">10.10 <a href="http://c.biancheng.net/view/2362.html">Python traceback模块：获取异常信息</a></dd><dd>10.11 <a href="http://c.biancheng.net/view/vip_6088.html">Python如何自定义一个异常类？</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.12 <a href="http://c.biancheng.net/view/vip_6089.html">正确使用Python异常处理机制</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.13 <a href="http://c.biancheng.net/view/vip_6090.html">Python使用logging模块调试程序</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.14 <a href="http://c.biancheng.net/view/vip_6091.html">Python IDLE调试程序</a><span class="iconfont iconfont-vip2"></span></dd><dd>10.15 <a href="http://c.biancheng.net/view/vip_6092.html">Python assert调试程序</a><span class="iconfont iconfont-vip2"></span></dd></dl>
<dd>
<span class="channel-num">11</span>
<a href="http://c.biancheng.net/python/module_package/">Python模块和包</a>
</dd>
<dd>
<span class="channel-num">12</span>
<a href="http://c.biancheng.net/python/file/">Python文件操作（I/O）</a>
</dd>
</div>
</div>
<div id="article-wrap">
<div id="article">
<div class="arc-info">
<span class="position"><span class="iconfont iconfont-home2"></span> <a href="http://c.biancheng.net/">首页</a> &gt; <a href="http://c.biancheng.net/python/">Python</a> &gt; <a href="http://c.biancheng.net/python/try_except/">Python异常处理机制</a></span>
</div>
<div id="ggxc-position-bottom" class="ggxc-box"><a href="http://fudao.biancheng.net/?source=positionbottom" target="_blank"><img width="100%" src="./Python traceback模块：获取异常信息_files/fudaoban_wap.png"></a></div>
<h1>Python traceback模块：获取异常信息</h1>
<div class="pre-next-page clearfix"><span class="pre left"><a href="http://c.biancheng.net/view/4611.html"><span class="icon">&lt;</span> 上一节</a></span><span class="next right"><a href="http://c.biancheng.net/view/vip_6088.html">下一节 <span class="icon">&gt;</span></a></span></div>
<div id="ggxc-arctop-pc-1" class="ggxc-box"><a href="http://fudao.biancheng.net/?source=arctop" target="_blank"><img width="100%" src="./Python traceback模块：获取异常信息_files/fudaoban_pc.png"></a></div>
<div id="arc-body">除了使用 sys.exc_info() 方法获取更多的异常信息之外，还可以使用 traceback 模块，该模块可以用来查看异常的传播轨迹，追踪异常触发的源头。<br>
<br>
下面示例显示了如何显示异常传播轨迹：
<div class="snippet-container" style="undefined;"><div class="sh_bright snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display: none;"><pre><a class="snippet-copy sh_url" href="http://c.biancheng.net/view/2362.html#" style="display: none;">复制</a><a class="snippet-text sh_url" href="http://c.biancheng.net/view/2362.html#">纯文本</a><a class="snippet-window sh_url" href="http://c.biancheng.net/view/2362.html#">复制</a></pre></div><pre class="python sh_python snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_keyword">class</span> <span class="sh_function">SelfException</span><span class="sh_symbol">(</span>Exception<span class="sh_symbol">):</span></li><li>    <span class="sh_keyword">pass</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">main</span><span class="sh_symbol">():</span></li><li>    <span class="sh_function">firstMethod</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">firstMethod</span><span class="sh_symbol">():</span></li><li>    <span class="sh_function">secondMethod</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">secondMethod</span><span class="sh_symbol">():</span></li><li>    <span class="sh_function">thirdMethod</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">thirdMethod</span><span class="sh_symbol">():</span></li><li>    <span class="sh_keyword">raise</span> <span class="sh_function">SelfException</span><span class="sh_symbol">(</span><span class="sh_string">"自定义异常信息"</span><span class="sh_symbol">)</span></li><li><span class="sh_function">main</span><span class="sh_symbol">()</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">class SelfException(Exception):
    pass
def main():
    firstMethod()
def firstMethod():
    secondMethod()
def secondMethod():
    thirdMethod()
def thirdMethod():
    raise SelfException("自定义异常信息")
main()</pre></div></div>
上面程序中 main() 函数调用 firstMethod()，firstMethod() 调用 secondMethod()，secondMethod() 调用 thirdMethod()，thirdMethod() 直接引发一个 SelfException 异常。运行上面程序，将会看到如下所示的结果：
<p class="info-box">
Traceback (most recent call last):<br>
&nbsp; File "C:\Users\mengma\Desktop\1.py", line 11, in &lt;module&gt;<br>
&nbsp;&nbsp;&nbsp; main()<br>
&nbsp; File "C:\Users\mengma\Desktop\1.py", line 4, in main&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(178, 34, 34);">&nbsp;&lt;--mian函数</span><br>
&nbsp;&nbsp;&nbsp; firstMethod()<br>
&nbsp; File "C:\Users\mengma\Desktop\1.py", line 6, in firstMethod&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(178, 34, 34);">&lt;--第三个</span><br>
&nbsp;&nbsp;&nbsp; secondMethod()<br>
&nbsp; File "C:\Users\mengma\Desktop\1.py", line 8, in secondMethod&nbsp; &nbsp;<span style="color: rgb(178, 34, 34);">&lt;--第二个</span><br>
&nbsp;&nbsp;&nbsp; thirdMethod()<br>
&nbsp; File "C:\Users\mengma\Desktop\1.py", line 10, in thirdMethod&nbsp; &nbsp; &nbsp;<span style="color: rgb(178, 34, 34);">&lt;--异常源头</span><br>
&nbsp;&nbsp;&nbsp; raise SelfException("自定义异常信息")<br>
SelfException: 自定义异常信息</p>
从输出结果可以看出，异常从 thirdMethod() 函数开始触发，传到 secondMethod() 函数，再传到 firstMethod() 函数，最后传到 main() 函数，在 main() 函数止，这个过程就是整个异常的传播轨迹。<br>
<br>
在实际应用程序的开发中，大多数复杂操作都会被分解成一系列函数或方法调用。这是因为，为了具有更好的可重用性，会将每个可重用的代码单元定义成函数或方法，将复杂任务逐渐分解为更易管理的小型子任务。由于一个大的业务功能需要由多个函数或方法来共同实现，在最终编程模型中，很多对象将通过一系列函数或方法调用来实现通信，执行任务。<br>
<br>
所以，当应用程序运行时，经常会发生一系列函数或方法调用，从而形成“函数调用战”。异常的传播则相反，只要异常没有被完全捕获（包括异常没有被捕获，或者异常被处理后重新引发了新异常），异常就从发生异常的函数或方法逐渐向外传播，首先传给该函数或方法的调用者，该函数或方法的调用者再传给其调用者，直至最后传到 <a href="http://c.biancheng.net/python/" target="_blank">Python</a> 解释器，此时 Python 解释器会中止该程序，并打印异常的传播轨迹信息。<br>
<p class="info-box">
很多初学者一看到输出结果所示的异常提示信息，就会惊慌失措，他们以为程序出现了很多严重的错误，其实只有一个错误，系统提示那么多行信息，只不过是显示异常依次触发的轨迹。</p>
其实，上面程序的运算结果显示的异常传播轨迹信息非常清晰，它记录了应用程序中执行停止的各个点。最后一行信息详细显示了异常的类型和异常的详细消息。从这一行向上，逐个记录了异常发生源头、异常依次传播所经过的轨迹，并标明异常发生在哪个文件、哪一行、哪个函数处。<br>
<br>
使用 traceback 模块查看异常传播轨迹，首先需要将 traceback 模块引入，该模块提供了如下两个常用方法：
<ul>
<li>
traceback.print_exc()：将异常传播轨迹信息输出到控制台或指定文件中。</li>
<li>
format_exc()：将异常传播轨迹信息转换成字符串。</li>
</ul>
<br>
可能有读者好奇，从上面方法看不出它们到底处理哪个异常的传播轨迹信息。实际上我们常用的 print_exc() 是 print_exc([limit[, file]]) 省略了 limit、file 两个参数的形式。而 print_exc([limit[, file]]) 的完整形式是&nbsp;<code style="font-size: 14px;">print_exception(etype, value, tb[,limit[, file]])</code>，在完整形式中，前面三个参数用于分别指定异常的如下信息：
<ul>
<li>
etype：指定异常类型；</li>
<li>
value：指定异常值；</li>
<li>
tb：指定异常的traceback 信息；</li>
</ul>
<br>
当程序处于 except 块中时，该 except 块所捕获的异常信息可通过 sys 对象来获取，其中 sys.exc_type、sys.exc_value、sys.exc_traceback 就代表当前 except 块内的异常类型、异常值和异常传播轨迹。<br>
<br>
简单来说， print_exc([limit[, file]]) 相当于如下形式：<br>
<p class="info-box">
print_exception(sys.exc_etype, sys.exc_value, sys.exc_tb[, limit[, file]])</p>
也就是说，使用 print_exc([limit[, file]]) 会自动处理当前 except 块所捕获的异常。该方法还涉及两个参数：
<ol>
<li>
limit：用于限制显示异常传播的层数，比如函数 A 调用函数 B，函数 B 发生了异常，如果指定 limit=1，则只显示函数 A 里面发生的异常。如果不设置 limit 参数，则默认全部显示。</li>
<li>
file：指定将异常传播轨迹信息输出到指定文件中。如果不指定该参数，则默认输出到控制台。</li>
</ol>
<br>
借助于 traceback 模块的帮助，我们可以使用 except 块捕获异常，并在其中打印异常传播信息，包括把它输出到文件中。例如如下程序：
<div class="snippet-container" style="undefined;"><div class="sh_bright snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre><a class="snippet-copy sh_url" href="http://c.biancheng.net/view/2362.html#" style="display: none;">复制</a><a class="snippet-text sh_url" href="http://c.biancheng.net/view/2362.html#">纯文本</a><a class="snippet-window sh_url" href="http://c.biancheng.net/view/2362.html#">复制</a></pre></div><pre class="python sh_python snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_comment"># 导入trackback模块</span></li><li><span class="sh_preproc">import</span> traceback</li><li><span class="sh_keyword">class</span> <span class="sh_function">SelfException</span><span class="sh_symbol">(</span>Exception<span class="sh_symbol">):</span> <span class="sh_keyword">pass</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">main</span><span class="sh_symbol">():</span></li><li>    <span class="sh_function">firstMethod</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">firstMethod</span><span class="sh_symbol">():</span></li><li>    <span class="sh_function">secondMethod</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">secondMethod</span><span class="sh_symbol">():</span></li><li>    <span class="sh_function">thirdMethod</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">def</span> <span class="sh_function">thirdMethod</span><span class="sh_symbol">():</span></li><li>    <span class="sh_keyword">raise</span> <span class="sh_function">SelfException</span><span class="sh_symbol">(</span><span class="sh_string">"自定义异常信息"</span><span class="sh_symbol">)</span></li><li><span class="sh_keyword">try</span><span class="sh_symbol">:</span></li><li>    <span class="sh_function">main</span><span class="sh_symbol">()</span></li><li><span class="sh_keyword">except</span><span class="sh_symbol">:</span></li><li>    <span class="sh_comment"># 捕捉异常，并将异常传播信息输出控制台</span></li><li>    traceback<span class="sh_symbol">.</span><span class="sh_function">print_exc</span><span class="sh_symbol">()</span></li><li>    <span class="sh_comment"># 捕捉异常，并将异常传播信息输出指定文件中</span></li><li>    traceback<span class="sh_symbol">.</span><span class="sh_function">print_exc</span><span class="sh_symbol">(</span>file<span class="sh_symbol">=</span><span class="sh_function">open</span><span class="sh_symbol">(</span><span class="sh_string">'log.txt'</span><span class="sh_symbol">,</span> <span class="sh_string">'a'</span><span class="sh_symbol">))</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"># 导入trackback模块
import traceback
class SelfException(Exception): pass

def main():
    firstMethod()
def firstMethod():
    secondMethod()
def secondMethod():
    thirdMethod()
def thirdMethod():
    raise SelfException("自定义异常信息")
try:
    main()
except:
    # 捕捉异常，并将异常传播信息输出控制台
    traceback.print_exc()
    # 捕捉异常，并将异常传播信息输出指定文件中
    traceback.print_exc(file=open('log.txt', 'a'))</pre></div></div>
上面程序第一行先导入了 traceback 模块，接下来程序使用 except 捕获程序的异常，并使用 traceback 的 print_exc() 方法输出异常传播信息，分别将它输出到控制台和指定文件中。<br>
<p class="info-box">
运行上面程序，同样可以看到在控制台输出异常传播信息，而且在程序目录下生成了一个 log.txt 文件，该文件中同样记录了异常传播信息。</p>
</div>
<div id="ggxc-weixin-arcbottom">
<p>关注公众号「<span class="col-green">站长严长生</span>」，在手机上阅读所有教程，随时随地都能学习。本公众号由<a class="col-link" href="http://c.biancheng.net/view/8092.html" target="_blank" rel="nofollow">站长</a>亲自运营，长期更新，坚持原创，专注于分享创业故事+学习历程+工作记录+生活日常+编程资料。</p>
<p style="margin-top:12px; text-align:center;">
<img src="./Python traceback模块：获取异常信息_files/qrcode_original.png" alt="公众号二维码" width="180"><br>
<span class="col-green">微信扫码关注公众号</span>
</p>
</div>
<div class="pre-next-page clearfix"><span class="pre left"><a href="http://c.biancheng.net/view/4611.html"><span class="icon">&lt;</span> 上一节</a></span><span class="next right"><a href="http://c.biancheng.net/view/vip_6088.html">下一节 <span class="icon">&gt;</span></a></span></div>
</div>
</div>
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 2362;
window.arcId = "1211pTEF7UOps561GMKgIKE0yRE8M4vfG+VHYx8OVILGnSOb9llhJ4wIXRQ";
window.typeidChain = "166|155";
</script>
<div id="footer" class="clearfix">
<div class="info left">
<p>精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。</p>
<p>
<a href="http://c.biancheng.net/view/8066.html" target="_blank" rel="nofollow">关于网站</a> <span>|</span>
<a href="http://c.biancheng.net/view/8092.html" target="_blank" rel="nofollow">关于站长</a> <span>|</span>
<a href="http://c.biancheng.net/view/8097.html" target="_blank" rel="nofollow">如何完成一部教程</a> <span>|</span>
<a href="http://c.biancheng.net/view/9648.html" target="_blank" rel="nofollow">公众号</a> <span>|</span>
<a href="http://c.biancheng.net/view/8093.html" target="_blank" rel="nofollow">联系我们</a> <span>|</span>
<a href="http://c.biancheng.net/sitemap/" target="_blank" rel="nofollow">网站地图</a>
</p>
<p>Copyright ©2012-2022 biancheng.net, <a href="https://beian.miit.gov.cn/" target="_blank" rel="nofollow" style="color:#666;">冀ICP备2022013920号</a>, <img height="13" src="./Python traceback模块：获取异常信息_files/gongan.png" alt="公安备案图标"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=13110202001352" target="_blank" rel="nofollow" style="color:#666;">冀公网安备13110202001352号</a>
</p>
</div>
<img id="logo_bottom" class="right" src="./Python traceback模块：获取异常信息_files/logo_bottom.gif" alt="底部Logo">
<span id="return-top"><b>↑</b></span>
</div>
<script type="text/javascript">
window.siteId = 4;
window.cmsTemplets = "/templets/new";
window.cmsTempletsVer = "1.6.83";
window.prePageURL = "/view/4611.html";
window.nextPageURL = "/view/vip_6088.html";
</script>
<script src="./Python traceback模块：获取异常信息_files/jquery1.12.4.min.js"></script>
<script src="./Python traceback模块：获取异常信息_files/common.js"></script>
<span style="display: none;"><script type="text/javascript" src="./Python traceback模块：获取异常信息_files/21368967.js"></script></span>

</body></html>